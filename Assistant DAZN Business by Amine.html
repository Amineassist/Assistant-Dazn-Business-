<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Assistant Prospection DAZN - CWC 2025</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f7fa;
      padding: 20px;
      color: #333;
    }
    h1, h2, h3 {
      color: #1a73e8;
    }
    textarea, input, button, select {
      width: 100%;
      margin-top: 10px;
      padding: 10px;
      font-size: 16px;
    }
    .arguments {
      background: #e8f0fe;
      padding: 10px;
      margin-top: 10px;
      border-left: 5px solid #1a73e8;
    }
    .map-container {
      height: 300px;
      margin: 20px 0;
      border: 1px solid #ddd;
      position: relative;
    }
    #map {
      height: 100%;
    }
    .flex-container {
      display: flex;
      gap: 20px;
    }
    .flex-item {
      flex: 1;
    }
    @media (max-width: 768px) {
      .flex-container {
        flex-direction: column;
      }
    }
    #manual-details {
      margin-top: 15px;
    }
  </style>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
</head>
<body>

<h1>🎯 Assistant en temps réel – DAZN CWC 2025</h1>

<div class="flex-container">
  <div class="flex-item">
    <h2>📍 Identification de l'établissement</h2>
    <input type="text" id="etablissement-search" placeholder="Nom de l'établissement + ville">
    <button type="button" onclick="searchEstablishment()">🔍 Rechercher</button>
    
    <div class="map-container">
      <div id="map"></div>
    </div>
    
    <div id="manual-details">
      <h3>📝 Complétez les détails manuellement</h3>
      <label>Type d'établissement</label>
      <select id="type" required>
        <option value="">Sélectionnez...</option>
        <option value="bar">Bar</option>
        <option value="brasserie">Brasserie</option>
        <option value="café">Café</option>
        <option value="restaurant">Restaurant</option>
        <option value="hôtel">Hôtel</option>
        <option value="club">Club sportif</option>
      </select>
      
      <label>Adresse</label>
      <input type="text" id="adresse" placeholder="Adresse complète">
      
      <label>Nombre d'écrans</label>
      <input type="number" id="ecrans" min="1" max="10" required>
      
      <label>Capacité approximative</label>
      <input type="number" id="capacite" min="1" placeholder="Nombre de clients">
      
      <label>Fournisseurs actuels (Canal+, beIN...)</label>
      <input type="text" id="fournisseurs">
    </div>
  </div>

  <div class="flex-item">
    <h2>🎤 Pitch personnalisé</h2>
    <button type="button" onclick="generatePitch()" style="background:#1a73e8;color:white;">Générer le pitch de vente</button>
    <div class="arguments" id="pitch"></div>
    
    <h2>📊 Analyse du potentiel</h2>
    <div id="potential-analysis" class="arguments"></div>
  </div>
</div>

<hr>
<h2>🎙️ Assistant vocal en direct – Analyse des objections</h2>

<button onclick="startRecognition()" style="padding:10px 20px;background:#e91e63;color:white;">🎤 Démarrer l'écoute</button>
<p id="status">Micro inactif.</p>

<div>
  <h3>🗣️ Ce que le client dit :</h3>
  <div id="transcription" style="border:1px solid #ccc; padding:10px; min-height:50px;"></div>

  <h3>💡 Suggestion pour répondre :</h3>
  <div id="suggestion" class="arguments" style="background:#f7f7f7;"></div>
</div>

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script>
// Carte Leaflet (OpenStreetMap)
let map;
let markers = [];

function initMap() {
  map = L.map('map').setView([48.8566, 2.3522], 13); // Paris par défaut
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  }).addTo(map);
  
  // Ajouter un marqueur au clic
  map.on('click', function(e) {
    clearMarkers();
    addMarker(e.latlng);
    document.getElementById("adresse").value = `Position: ${e.latlng.lat.toFixed(4)}, ${e.latlng.lng.toFixed(4)}`;
  });
}

function addMarker(latlng) {
  const marker = L.marker(latlng).addTo(map);
  markers.push(marker);
}

function clearMarkers() {
  markers.forEach(marker => map.removeLayer(marker));
  markers = [];
}

function searchEstablishment() {
  const query = document.getElementById("etablissement-search").value;
  if (!query) return;
  
  // Simulation de recherche (en réalité on utiliserait un service de géocodage)
  document.getElementById("potential-analysis").innerHTML = `
    <p>🔍 <strong>${query}</strong> - Analyse basée sur les informations fournies:</p>
    <ul>
      <li>Type: <span id="display-type">À définir</span></li>
      <li>Capacité: <span id="display-capacite">À définir</span></li>
      <li>Écrans: <span id="display-ecrans">À définir</span></li>
    </ul>
    <p>💡 <strong>Conseil:</strong> Complétez les détails à gauche pour une analyse précise.</p>
  `;
  
  // Centrer sur une position aléatoire proche (simulation)
  const lat = 48.8566 + (Math.random() * 0.02 - 0.01);
  const lng = 2.3522 + (Math.random() * 0.02 - 0.01);
  map.setView([lat, lng], 16);
  clearMarkers();
  addMarker([lat, lng]);
  
  // Mettre à jour l'analyse quand les champs changent
  document.getElementById("type").addEventListener("change", updateAnalysis);
  document.getElementById("capacite").addEventListener("input", updateAnalysis);
  document.getElementById("ecrans").addEventListener("input", updateAnalysis);
}

function updateAnalysis() {
  const type = document.getElementById("type").value || "À définir";
  const capacite = document.getElementById("capacite").value || "À définir";
  const ecrans = document.getElementById("ecrans").value || "À définir";
  
  document.getElementById("display-type").textContent = type;
  document.getElementById("display-capacite").textContent = capacite;
  document.getElementById("display-ecrans").textContent = ecrans;
  
  let conseil = "";
  if (type !== "À définir" && capacite !== "À définir" && ecrans !== "À définir") {
    const score = (parseInt(capacite) * parseInt(ecrans)) / 10;
    
    if (score > 50) {
      conseil = "🔥 Fort potentiel! Cet établissement pourrait générer un trafic important pendant la CWC.";
    } else if (score > 20) {
      conseil = "👍 Bon potentiel. Proposez des formules avec 1-2 écrans pour commencer.";
    } else {
      conseil = "💡 Potentiel modéré. Mettez en avant l'offre d'essai sans engagement.";
    }
    
    conseil += ` Score de potentiel: ${Math.round(score)}/100`;
  }
  
  if (conseil) {
    document.querySelector("#potential-analysis p:last-child").textContent = conseil;
  }
}

// Pitch generator amélioré
function generatePitch() {
  const nom = document.getElementById("etablissement-search").value || "l'établissement";
  const type = document.getElementById("type").value || "établissement";
  const ecrans = parseInt(document.getElementById("ecrans").value) || 1;
  const capacite = parseInt(document.getElementById("capacite").value) || 30;
  const fournisseurs = document.getElementById("fournisseurs").value;
  const adresse = document.getElementById("adresse").value;

  let formule = "";
  if (ecrans <= 2) formule = "89€/mois";
  else if (ecrans <= 5) formule = "129€/mois";
  else formule = "199€/mois";

  const intro = `Bonjour, je vous appelle de la part de DAZN Business France dans le cadre du lancement de la Coupe du Monde des Clubs 2025. Nous diffusons en exclusivité l'intégralité des 63 matchs, dont PSG - Atletico et la finale.`;

  let personnalisé = `Je vois que ${nom} est un ${type} ${adresse ? `situé ${adresse}` : ''}. C'est une belle opportunité d'attirer les passionnés de sport cet été.`;
  
  // Adaptation en fonction de la capacité
  if (capacite > 100) {
    personnalisé += ` Avec votre capacité d'accueil (${capacite} personnes), vous pourriez organiser des événements autour des matchs importants.`;
  } else if (capacite > 50) {
    personnalisé += ` Vos ${capacite} places assises seront idéales pour accueillir des groupes de supporters.`;
  }

  // Adaptation en fonction des fournisseurs actuels
  if (fournisseurs.includes("Canal+")) {
    personnalisé += ` Je vois que vous êtes déjà client Canal+, DAZN est le complément parfait pour offrir à vos clients toute la Coupe du Monde des Clubs.`;
  } else if (fournisseurs.includes("beIN")) {
    personnalisé += ` En complément de beIN Sports, DAZN vous permettra de proposer une offre sportive complète à vos clients.`;
  }

  const offre = `Nous avons une formule à ${formule}, adaptée à vos ${ecrans} écran(s), avec engagement 12 mois, contenu illimité et matériel fourni.`;

  const action = `Souhaitez-vous qu'on planifie l'installation avant le lancement ? Vous bénéficiez de notre offre d'essai sans engagement jusqu'au 31 août.`;

  document.getElementById("pitch").innerHTML = `
    <p><strong>Introduction :</strong> ${intro}</p>
    <p><strong>Personnalisation :</strong> ${personnalisé}</p>
    <p><strong>Offre :</strong> ${offre}</p>
    <p><strong>Appel à l'action :</strong> ${action}</p>
  `;
}

// Assistant vocal
const keywords = {
  "TF1": "✅ Seuls 2 matchs seront sur TF1 (PSG-Atletico & la finale). Les 61 autres sont exclusivement sur DAZN.",
  "trop cher": "💰 Nos tarifs sont environ 40% inférieurs à Canal+ et RMC pour les pros, avec tous les matchs inclus.",
  "déjà abonné": "📦 DAZN complète parfaitement votre offre actuelle, surtout pour la CWC que les autres ne diffusent pas.",
  "j'attends la ligue 1": "⚽ DAZN diffuse aussi les 2 dernières journées de Ligue 1 + barrages + compétitions internationales.",
  "je veux réfléchir": "🕐 L'offre sans engagement jusqu'au 31 août vous permet de tester sans risque.",
  "pas de clients": "📈 Justement, la CWC attire du monde : 63 matchs en 4 semaines, parfait pour créer du trafic.",
  "c'est compliqué": "🔧 On fournit le matériel, le service est clé en main, activation rapide.",
  "pas d'écran": "📺 Même un seul écran suffit ! Notre formule Essentielle à 89€/mois est parfaite pour démarrer."
};

let recognition;
function startRecognition() {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SpeechRecognition();
  recognition.lang = "fr-FR";
  recognition.continuous = true;
  recognition.interimResults = true;

  document.getElementById('status').innerText = "🎧 Micro activé – En écoute...";

  recognition.onresult = function(event) {
    let transcript = "";
    for (let i = event.resultIndex; i < event.results.length; ++i) {
      transcript += event.results[i][0].transcript;
    }
    document.getElementById("transcription").innerText = transcript;

    let lower = transcript.toLowerCase();
    for (let key in keywords) {
      if (lower.includes(key)) {
        document.getElementById("suggestion").innerText = keywords[key];
        return;
      }
    }
    document.getElementById("suggestion").innerText = "Aucune objection détectée. Continuez l'échange.";
  };

  recognition.onerror = function(event) {
    document.getElementById('status').innerText = "❌ Erreur de reconnaissance vocale.";
  };

  recognition.onend = function() {
    document.getElementById('status').innerText = "🛑 Micro arrêté.";
  };

  recognition.start();
}

// Initialisation
document.addEventListener('DOMContentLoaded', function() {
  initMap();
});
</script>

</body>
</html>